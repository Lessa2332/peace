<!DOCTYPE html>
<html>
<head>
  <title>AR Planet App</title>
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script>
    // Компонент для обробки жестів (обертання пальцем, pinch для зуму)
    AFRAME.registerComponent('gesture-handler', {
      init: function () {
        this.targetRotation = this.el.getAttribute('rotation') || {x: 0, y: 0, z: 0};
        this.initialScale = this.el.object3D.scale.x;
        this.previousTouchDistance = 0;
        this.isRotating = false;
        this.isPinching = false;
        this.startX = 0;
        this.startY = 0;

        document.addEventListener('touchstart', this.onTouchStart.bind(this));
        document.addEventListener('touchmove', this.onTouchMove.bind(this));
        document.addEventListener('touchend', this.onTouchEnd.bind(this));
      },
      onTouchStart: function (evt) {
        if (evt.touches.length === 1) {
          this.isRotating = true;
          this.startX = evt.touches[0].pageX;
          this.startY = evt.touches[0].pageY;
        } else if (evt.touches.length === 2) {
          this.isPinching = true;
          this.previousTouchDistance = Math.hypot(
            evt.touches[0].pageX - evt.touches[1].pageX,
            evt.touches[0].pageY - evt.touches[1].pageY
          );
          this.initialScale = this.el.object3D.scale.x;
        }
      },
      onTouchMove: function (evt) {
        evt.preventDefault();
        if (this.isRotating && evt.touches.length === 1) {
          const deltaX = evt.touches[0].pageX - this.startX;
          const deltaY = evt.touches[0].pageY - this.startY;
          this.targetRotation.y += deltaX * 0.5;
          this.targetRotation.x += deltaY * 0.5;
          this.el.setAttribute('rotation', `${this.targetRotation.x} ${this.targetRotation.y} 0`);
          this.startX = evt.touches[0].pageX;
          this.startY = evt.touches[0].pageY;
        } else if (this.isPinching && evt.touches.length === 2) {
          const currentTouchDistance = Math.hypot(
            evt.touches[0].pageX - evt.touches[1].pageX,
            evt.touches[0].pageY - evt.touches[1].pageY
          );
          const scaleFactor = currentTouchDistance / this.previousTouchDistance;
          const newScale = Math.max(0.5, Math.min(3, this.initialScale * scaleFactor)); // Обмеження зуму
          this.el.setAttribute('scale', `${newScale} ${newScale} ${newScale}`);
          this.previousTouchDistance = currentTouchDistance;
        }
      },
      onTouchEnd: function (evt) {
        if (evt.touches.length === 0) {
          this.isRotating = false;
          this.isPinching = false;
        }
      }
    });

    // Компонент для кліку на точку (показ alert з завданням)
    AFRAME.registerComponent('click-task', {
      schema: { task: { type: 'string' } },
      init: function () {
        this.el.addEventListener('click', () => {
          alert(this.data.task);
        });
      }
    });
  </script>
</head>
<body>
  <a-scene webxr="requiredFeatures: hit-test, local-floor; optionalFeatures: dom-overlay">
    <a-camera id="camera" cursor="rayOrigin: mouse; fuse: false" raycaster="objects: .clickable"></a-camera>

    <a-sphere id="planet"
              position="0 1 -1"
              radius="0.5"
              src="https://www.solarsystemscope.com/textures/download/8k_earth_daymap.jpg"
              gesture-handler
              scale="1 1 1">
      <!-- Точки з номерами (розташовані на поверхні, завжди дивляться на камеру) -->
      <a-text class="clickable"
              value="1"
              position="0 0.55 0"
              scale="0.2 0.2 0.2"
              look-at="#camera"
              click-task="task: Мир починається з тебе! Напиши 3 добрі вчинки, які можеш зробити сьогодні."></a-text>
      <a-text class="clickable"
              value="2"
              position="0.55 0 0"
              scale="0.2 0.2 0.2"
              look-at="#camera"
              click-task="task: Захисти планету! Назви 3 способи зменшити пластикові відходи."></a-text>
      <a-text class="clickable"
              value="3"
              position="0 -0.55 0"
              scale="0.2 0.2 0.2"
              look-at="#camera"
              click-task="task: Будь добрим! Поділися компліментом з другом."></a-text>
      <a-text class="clickable"
              value="4"
              position="-0.55 0 0"
              scale="0.2 0.2 0.2"
              look-at="#camera"
              click-task="task: Навчайся! Що ти хочеш вивчити цього тижня?"></a-text>
    </a-sphere>
  </a-scene>
</body>
</html>
